<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High Courts Case Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#64748b'
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-semibold text-primary">
                        üèõÔ∏è High Courts Case Search
                    </h1>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Search Form -->
        <div id="searchForm" class="max-w-4xl mx-auto">
            <div class="bg-white rounded-lg shadow-sm border p-8">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">Case Search</h2>
                    <p class="text-gray-600">Search for case details across Indian High Courts</p>
                </div>

                <form id="caseSearchForm" class="space-y-6">
                    <!-- State Selection -->
                    <div>
                        <label for="state" class="block text-sm font-medium text-gray-700 mb-2">
                            High Court
                        </label>
                        <select id="state" name="state" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                            <option value="">Select High Court</option>
                        </select>
                        <div id="loadingStates" class="hidden mt-2 text-sm text-gray-600">
                            <div class="inline-flex items-center">
                                <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-primary"
                                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                    </path>
                                </svg>
                                Loading states...
                            </div>
                        </div>
                    </div>

                    <!-- Bench Selection -->
                    <div>
                        <label for="bench" class="block text-sm font-medium text-gray-700 mb-2">
                            Bench
                        </label>
                        <select id="bench" name="bench" required disabled
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary bg-gray-100">
                            <option value="">Select Bench (Choose High Court first)</option>
                        </select>
                        <div id="loadingBenches" class="hidden mt-2 text-sm text-gray-600">
                            <div class="inline-flex items-center">
                                <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-primary"
                                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                    </path>
                                </svg>
                                Loading benches...
                            </div>
                        </div>
                    </div>

                    <!-- Case Type Selection -->
                    <div>
                        <label for="caseType" class="block text-sm font-medium text-gray-700 mb-2">
                            Case Type
                        </label>
                        <select id="caseType" name="caseType" required disabled
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary bg-gray-100">
                            <option value="">Select Case Type (Choose Bench first)</option>
                        </select>
                        <div id="loadingCaseTypes" class="hidden mt-2 text-sm text-gray-600">
                            <div class="inline-flex items-center">
                                <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-primary"
                                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                    </path>
                                </svg>
                                Loading case types...
                            </div>
                        </div>
                    </div>

                    <!-- Case Number -->
                    <div>
                        <label for="caseNo" class="block text-sm font-medium text-gray-700 mb-2">
                            Case Number
                        </label>
                        <input type="text" id="caseNo" name="caseNo" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"
                            placeholder="Enter case number">
                    </div>

                    <!-- Year -->
                    <div>
                        <label for="year" class="block text-sm font-medium text-gray-700 mb-2">
                            Year
                        </label>
                        <input type="number" id="year" name="year" required min="2000" max="2030"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"
                            placeholder="Enter year (e.g., 2024)" value="2024">
                    </div>

                    <!-- CAPTCHA -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            CAPTCHA
                        </label>
                        <div class="flex items-center space-x-4">
                            <div class="flex-1">
                                <img id="captchaImage" src="" alt="CAPTCHA"
                                    class="h-12 border border-gray-300 rounded-md" style="display: none;">
                                <div id="loadingCaptcha"
                                    class="h-12 bg-gray-100 rounded-md flex items-center justify-center">
                                    <div class="inline-flex items-center text-sm text-gray-600">
                                        <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-primary"
                                            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                                stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor"
                                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                            </path>
                                        </svg>
                                        Loading CAPTCHA...
                                    </div>
                                </div>
                            </div>
                            <button type="button" id="refreshCaptcha"
                                class="px-3 py-2 text-sm text-primary hover:text-blue-700">
                                üîÑ Refresh
                            </button>
                        </div>
                        <input type="text" id="captchaValue" name="captchaValue" required
                            class="mt-2 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"
                            placeholder="Enter CAPTCHA text">
                    </div>

                    <!-- Submit Button -->
                    <div class="pt-4">
                        <button type="submit" id="searchButton"
                            class="w-full bg-primary text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <span id="searchButtonText">üîç Search Case</span>
                            <span id="searchButtonLoading" class="hidden">
                                <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline"
                                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                    </path>
                                </svg>
                                Searching...
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Results Table -->
        <div id="resultsTable" class="max-w-6xl mx-auto hidden">
            <div class="bg-white rounded-lg shadow-sm border p-8">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">Search Results</h2>
                    <p class="text-gray-600">Select a case to view detailed information</p>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    #</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Case Number</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Petitioner</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Respondent</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Filing Date</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Action</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTableBody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>

                <div class="mt-8 text-center">
                    <button onclick="showSearchForm()"
                        class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        ‚Üê New Search
                    </button>
                </div>
            </div>
        </div>

        <!-- Case Details -->
        <div id="caseDetails" class="max-w-7xl mx-auto space-y-8 hidden">
            <div class="bg-white rounded-lg shadow-sm border p-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900 mb-2">Case Details</h2>
                        <p class="text-gray-600">Comprehensive case information from eCourts Portal</p>
                    </div>
                    <button onclick="showSearchForm()"
                        class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                        ‚Üê New Search
                    </button>
                </div>
            </div>

            <div id="caseDetailsContent" class="space-y-8">
                <!-- Case details will be populated here -->
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg p-8 max-w-sm mx-auto text-center">
                <div class="inline-flex items-center text-lg text-gray-900 mb-4">
                    <svg class="animate-spin -ml-1 mr-3 h-6 w-6 text-primary" xmlns="http://www.w3.org/2000/svg"
                        fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                    Loading case details...
                </div>
                <p class="text-gray-600">Please wait while we fetch the case information</p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <p class="text-center text-gray-500 text-sm">
                High Courts Case Search - Powered by eCourts Portal
            </p>
        </div>
    </footer>

    <script>
        // Global variables
        let currentResults = [];
        let selectedCase = null;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function () {
            loadStates();
            loadCaptcha();

            // Event listeners
            document.getElementById('state').addEventListener('change', handleStateChange);
            document.getElementById('bench').addEventListener('change', handleBenchChange);
            document.getElementById('caseSearchForm').addEventListener('submit', handleSearch);
            document.getElementById('refreshCaptcha').addEventListener('click', loadCaptcha);
        });

        // Load states
        async function loadStates() {
            showLoading('loadingStates');
            try {
                const response = await fetch('/api/states');
                const data = await response.json();

                if (data.success) {
                    const stateSelect = document.getElementById('state');
                    stateSelect.innerHTML = '<option value="">Select High Court</option>';

                    data.states.forEach(state => {
                        const option = document.createElement('option');
                        option.value = state;
                        option.textContent = state;
                        stateSelect.appendChild(option);
                    });
                } else {
                    showError('Failed to load states');
                }
            } catch (error) {
                showError('Error loading states: ' + error.message);
            } finally {
                hideLoading('loadingStates');
            }
        }

        // Handle state change
        async function handleStateChange() {
            const selectedState = this.value;
            if (selectedState) {
                await loadBenches(selectedState);
            } else {
                resetBench();
                resetCaseType();
            }
        }

        // Load benches
        async function loadBenches(stateName) {
            resetBench();
            resetCaseType();
            showLoading('loadingBenches');

            try {
                const response = await fetch('/api/benches', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ state: stateName })
                });
                const data = await response.json();

                if (data.success) {
                    const benchSelect = document.getElementById('bench');
                    benchSelect.disabled = false;
                    benchSelect.classList.remove('bg-gray-100');
                    benchSelect.innerHTML = '<option value="">Select Bench</option>';

                    data.benches.forEach(bench => {
                        const option = document.createElement('option');
                        option.value = bench;
                        option.textContent = bench;
                        benchSelect.appendChild(option);
                    });
                } else {
                    showError('Failed to load benches');
                }
            } catch (error) {
                showError('Error loading benches: ' + error.message);
            } finally {
                hideLoading('loadingBenches');
            }
        }

        // Handle bench change
        async function handleBenchChange() {
            const selectedState = document.getElementById('state').value;
            const selectedBench = this.value;
            if (selectedState && selectedBench) {
                await loadCaseTypes(selectedState, selectedBench);
            } else {
                resetCaseType();
            }
        }

        // Load case types
        async function loadCaseTypes(stateName, benchName) {
            resetCaseType();
            showLoading('loadingCaseTypes');

            try {
                const response = await fetch('/api/case-types', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ state: stateName, bench: benchName })
                });
                const data = await response.json();

                if (data.success) {
                    const caseTypeSelect = document.getElementById('caseType');
                    caseTypeSelect.disabled = false;
                    caseTypeSelect.classList.remove('bg-gray-100');
                    caseTypeSelect.innerHTML = '<option value="">Select Case Type</option>';

                    data.case_types.forEach(caseType => {
                        const option = document.createElement('option');
                        option.value = caseType;
                        option.textContent = caseType;
                        caseTypeSelect.appendChild(option);
                    });
                } else {
                    showError('Failed to load case types');
                }
            } catch (error) {
                showError('Error loading case types: ' + error.message);
            } finally {
                hideLoading('loadingCaseTypes');
            }
        }

        // Load CAPTCHA
        async function loadCaptcha() {
            showLoading('loadingCaptcha');
            document.getElementById('captchaImage').style.display = 'none';

            try {
                const response = await fetch('/api/captcha');
                const data = await response.json();

                if (data.success) {
                    const captchaImage = document.getElementById('captchaImage');
                    captchaImage.src = data.captcha_image;
                    captchaImage.style.display = 'block';
                    document.getElementById('captchaValue').value = '';
                } else {
                    showError('Failed to load CAPTCHA');
                }
            } catch (error) {
                showError('Error loading CAPTCHA: ' + error.message);
            } finally {
                hideLoading('loadingCaptcha');
            }
        }

        // Handle search
        async function handleSearch(e) {
            e.preventDefault();

            const formData = new FormData(e.target);
            const searchData = {
                state: formData.get('state'),
                bench: formData.get('bench'),
                case_type: formData.get('caseType'),
                case_no: formData.get('caseNo'),
                year: formData.get('year'),
                captcha_value: formData.get('captchaValue')
            };

            if (!Object.values(searchData).every(value => value)) {
                showError('Please fill in all fields');
                return;
            }

            setSearchButtonLoading(true);

            try {
                const response = await fetch('/api/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(searchData)
                });
                const data = await response.json();

                if (data.success) {
                    currentResults = data.results;
                    if (currentResults.length === 1) {
                        // Single result, show details directly
                        await showCaseDetails(currentResults[0]);
                    } else {
                        // Multiple results, show selection table
                        showResultsTable(currentResults);
                    }
                } else {
                    showError(data.detail || 'Search failed');
                    // Refresh CAPTCHA on error
                    loadCaptcha();
                }
            } catch (error) {
                showError('Error during search: ' + error.message);
                loadCaptcha();
            } finally {
                setSearchButtonLoading(false);
            }
        }

        // Show results table
        function showResultsTable(results) {
            const tbody = document.getElementById('resultsTableBody');
            tbody.innerHTML = '';

            results.forEach((result, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${index + 1}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${result.case_no || 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${result.petitioner || 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${result.respondent || 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${result.filing_date || 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="selectCase(${index})" 
                                class="text-primary hover:text-blue-700 bg-blue-50 hover:bg-blue-100 px-3 py-1 rounded-md text-xs font-medium transition-colors">
                            üìã View Details
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            showElement('resultsTable');
            hideElement('searchForm');
            hideElement('caseDetails');
        }

        // Select case
        async function selectCase(index) {
            const caseData = currentResults[index];
            await showCaseDetails(caseData);
        }

        // Show case details
        async function showCaseDetails(caseData) {
            selectedCase = caseData;
            showLoadingOverlay();

            try {
                const response = await fetch('/api/case-details', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ case: caseData })
                });
                const data = await response.json();

                if (data.success) {
                    displayCaseDetails(data.case_data);
                } else {
                    showError(data.detail || 'Failed to load case details');
                }
            } catch (error) {
                showError('Error loading case details: ' + error.message);
            } finally {
                hideLoadingOverlay();
            }
        }

        // Display case details
        function displayCaseDetails(caseData) {
            const container = document.getElementById('caseDetailsContent');
            container.innerHTML = '';

            // Case Details
            if (caseData.case_details && Object.keys(caseData.case_details).length > 0) {
                container.appendChild(createSection('üìã Case Details', createKeyValueGrid(caseData.case_details)));
            }

            // Case Status
            if (caseData.case_status && Object.keys(caseData.case_status).length > 0) {
                container.appendChild(createSection('üìä Case Status', createKeyValueGrid(caseData.case_status)));
            }

            // FIR Details
            if (caseData.fir_details && Object.keys(caseData.fir_details).length > 0) {
                container.appendChild(createSection('üö® FIR Details', createKeyValueGrid(caseData.fir_details)));
            }

            // Parties
            if (caseData.parties) {
                const partiesContainer = document.createElement('div');
                partiesContainer.className = 'grid grid-cols-1 lg:grid-cols-2 gap-6';

                if (caseData.parties.petitioners) {
                    partiesContainer.appendChild(createPartiesSection('üë• Petitioners', caseData.parties.petitioners));
                }
                if (caseData.parties.respondents) {
                    partiesContainer.appendChild(createPartiesSection('üë• Respondents', caseData.parties.respondents));
                }

                if (partiesContainer.children.length > 0) {
                    container.appendChild(createSection('', partiesContainer));
                }
            }

            // Legal Information - Individual sections
            if (caseData.acts && caseData.acts.length > 0) {
                container.appendChild(createActsSection(caseData.acts));
            }
            if (caseData.categories && Object.keys(caseData.categories).length > 0) {
                container.appendChild(createSection('üìÇ Categories', createKeyValueGrid(caseData.categories)));
            }
            if (caseData.subordinate_court && Object.keys(caseData.subordinate_court).length > 0) {
                container.appendChild(createSection('‚öñÔ∏è Subordinate Court', createKeyValueGrid(caseData.subordinate_court)));
            }

            // Hearing History
            if (caseData.hearing_history && caseData.hearing_history.length > 0) {
                container.appendChild(createHearingHistorySection(caseData.hearing_history));
            }

            // Orders
            if (caseData.orders && caseData.orders.length > 0) {
                container.appendChild(createOrdersSection(caseData.orders));
            }

            // Objections
            if (caseData.objections && caseData.objections.length > 0) {
                container.appendChild(createObjectionsSection(caseData.objections));
            }

            showElement('caseDetails');
            hideElement('searchForm');
            hideElement('resultsTable');
        }

        // Helper functions
        function createSection(title, content) {
            const section = document.createElement('div');
            section.className = 'bg-white rounded-lg shadow-sm border p-6';

            if (title) {
                const titleElement = document.createElement('h3');
                titleElement.className = 'text-xl font-semibold text-gray-900 mb-4';
                titleElement.textContent = title;
                section.appendChild(titleElement);
            }

            section.appendChild(content);
            return section;
        }

        function createKeyValueGrid(data) {
            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';

            Object.entries(data).forEach(([key, value]) => {
                const item = document.createElement('div');
                item.className = 'flex justify-between py-2 border-b border-gray-100';
                item.innerHTML = `
                    <span class="font-medium text-gray-700">${key}</span>
                    <span class="text-gray-900">${value}</span>
                `;
                grid.appendChild(item);
            });

            return grid;
        }

        function createPartiesSection(title, parties) {
            const section = document.createElement('div');
            section.className = 'bg-white rounded-lg shadow-sm border p-6';

            const titleElement = document.createElement('h3');
            titleElement.className = 'text-xl font-semibold text-gray-900 mb-4';
            titleElement.textContent = `${title} (${parties.length})`;
            section.appendChild(titleElement);

            parties.forEach(party => {
                const partyDiv = document.createElement('div');
                partyDiv.className = 'mb-4 p-4 bg-gray-50 rounded-lg';
                partyDiv.innerHTML = `
                    <div class="font-medium text-gray-900">${party.name}</div>
                    ${party.advocate ? `<div class="text-sm text-gray-600 mt-1">Advocate: ${party.advocate}</div>` : ''}
                    ${party.details ? `<div class="text-sm text-gray-500 mt-1">${party.details.join('<br>')}</div>` : ''}
                `;
                section.appendChild(partyDiv);
            });

            return section;
        }

        function createActsSection(acts) {
            const section = document.createElement('div');
            section.className = 'bg-white rounded-lg shadow-sm border p-6';

            const titleElement = document.createElement('h3');
            titleElement.className = 'text-xl font-semibold text-gray-900 mb-4';
            titleElement.textContent = `üìú Acts (${acts.length})`;
            section.appendChild(titleElement);

            acts.forEach(act => {
                const actDiv = document.createElement('div');
                actDiv.className = 'mb-3 p-3 bg-gray-50 rounded-lg';
                actDiv.innerHTML = `
                    <div class="font-medium text-gray-900">${act.act}</div>
                    <div class="text-sm text-gray-600 mt-1">Section: ${act.section}</div>
                `;
                section.appendChild(actDiv);
            });

            return section;
        }

        function createHearingHistorySection(hearings) {
            const section = document.createElement('div');
            section.className = 'bg-white rounded-lg shadow-sm border p-6';

            const titleElement = document.createElement('h3');
            titleElement.className = 'text-xl font-semibold text-gray-900 mb-4';
            titleElement.textContent = `üìÖ Hearing History (${hearings.length} entries)`;
            section.appendChild(titleElement);

            const table = document.createElement('table');
            table.className = 'min-w-full divide-y divide-gray-200';
            table.innerHTML = `
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Purpose</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Judge</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    ${hearings.slice(0, 10).map(hearing => `
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${hearing.hearing_date || hearing.business_date || 'N/A'}</td>
                            <td class="px-6 py-4 text-sm text-gray-900">${hearing.purpose}</td>
                            <td class="px-6 py-4 text-sm text-gray-900">${hearing.judge || 'N/A'}</td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
            section.appendChild(table);

            if (hearings.length > 10) {
                const infoDiv = document.createElement('div');
                infoDiv.className = 'mt-4 text-center text-sm text-gray-600';
                infoDiv.textContent = `Showing first 10 entries. Total: ${hearings.length} entries`;
                section.appendChild(infoDiv);
            }

            return section;
        }

        function createOrdersSection(orders) {
            const section = document.createElement('div');
            section.className = 'bg-white rounded-lg shadow-sm border p-6';

            const titleElement = document.createElement('h3');
            titleElement.className = 'text-xl font-semibold text-gray-900 mb-4';
            titleElement.textContent = `üìÑ Orders (${orders.length})`;
            section.appendChild(titleElement);

            orders.forEach(order => {
                const orderDiv = document.createElement('div');
                orderDiv.className = 'p-4 bg-gray-50 rounded-lg mb-4';

                // Create proxy URL for PDF
                let pdfLink = '';
                if (order.pdf_url) {
                    const filename = order.pdf_url.split('filename=')[1]?.split('&')[0] || 'order.pdf';
                    const proxyUrl = `/api/pdf-proxy?filename=${filename}&original_url=${encodeURIComponent(order.pdf_url)}`;
                    pdfLink = `<a href="${proxyUrl}" target="_blank" class="inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-white bg-primary hover:bg-blue-700">üìÑ View PDF</a>`;
                }

                orderDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="font-medium text-gray-900">Order ${order.order_number}</div>
                            <div class="text-sm text-gray-600 mt-1">${order.order_on}</div>
                            <div class="text-sm text-gray-600">${order.order_date}</div>
                            <div class="text-sm text-gray-600 mt-1">${order.judge}</div>
                        </div>
                        ${pdfLink}
                    </div>
                `;
                section.appendChild(orderDiv);
            });

            return section;
        }

        function createObjectionsSection(objections) {
            const section = document.createElement('div');
            section.className = 'bg-white rounded-lg shadow-sm border p-6';

            const titleElement = document.createElement('h3');
            titleElement.className = 'text-xl font-semibold text-gray-900 mb-4';
            titleElement.textContent = `‚ö†Ô∏è Objections (${objections.length})`;
            section.appendChild(titleElement);

            objections.forEach(objection => {
                const objectionDiv = document.createElement('div');
                objectionDiv.className = 'p-4 bg-gray-50 rounded-lg mb-4';
                objectionDiv.innerHTML = `
                    <div class="font-medium text-gray-900">${objection.objection}</div>
                    <div class="text-sm text-gray-600 mt-1">Date: ${objection.scrutiny_date}</div>
                    ${objection.compliance_date ? `<div class="text-sm text-gray-600">Compliance: ${objection.compliance_date}</div>` : ''}
                `;
                section.appendChild(objectionDiv);
            });

            return section;
        }

        // Utility functions
        function resetBench() {
            const benchSelect = document.getElementById('bench');
            benchSelect.innerHTML = '<option value="">Select Bench (Choose High Court first)</option>';
            benchSelect.disabled = true;
            benchSelect.classList.add('bg-gray-100');
        }

        function resetCaseType() {
            const caseTypeSelect = document.getElementById('caseType');
            caseTypeSelect.innerHTML = '<option value="">Select Case Type (Choose Bench first)</option>';
            caseTypeSelect.disabled = true;
            caseTypeSelect.classList.add('bg-gray-100');
        }

        function showSearchForm() {
            showElement('searchForm');
            hideElement('resultsTable');
            hideElement('caseDetails');
            // Reload CAPTCHA when returning to search form
            loadCaptcha();
        }

        function showElement(id) {
            document.getElementById(id).classList.remove('hidden');
        }

        function hideElement(id) {
            document.getElementById(id).classList.add('hidden');
        }

        function showLoading(id) {
            document.getElementById(id).classList.remove('hidden');
        }

        function hideLoading(id) {
            document.getElementById(id).classList.add('hidden');
        }

        function showLoadingOverlay() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoadingOverlay() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        function setSearchButtonLoading(loading) {
            const button = document.getElementById('searchButton');
            const text = document.getElementById('searchButtonText');
            const loadingText = document.getElementById('searchButtonLoading');

            if (loading) {
                button.disabled = true;
                text.classList.add('hidden');
                loadingText.classList.remove('hidden');
            } else {
                button.disabled = false;
                text.classList.remove('hidden');
                loadingText.classList.add('hidden');
            }
        }

        function showError(message) {
            // Simple error display - you can enhance this
            alert(message);
        }
    </script>
</body>

</html>